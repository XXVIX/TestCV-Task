# Система анализа объектов в ресторане

Прототип системы для детекции, трекинга и анализа "жизненного цикла" объектов на видео.

## Установка

1.  Клонируйте репозиторий:
    ```bash
    git clone [URL-вашего-репозитория]
    cd [название-папки]
    ```
2.  Создайте виртуальное окружение и установите зависимости:
    ```bash
    python -m venv .venv
    .\.venv\Scripts\activate
    pip install -r requirements.txt
    ```

## Порядок работы

### 1. Подготовка данных

1.  **Извлечение кадров:** Поместите исходные видео в папку `data/videos` и выполните:
    ```bash
    python src/data/extract_frames.py --input_dir data/videos
    ```
    Кадры будут сохранены в `data/raw_frames`.

2.  **Аннотация:** Используйте любой инструмент (например, CVAT) для разметки объектов в `data/raw_frames`. Сохраните разметку в формате YOLO в папку `data/labels`.

3.  **Разделение на train/val/test:** Запустите скрипт для создания датасета для обучения.
    ```bash
    python src/data/organize_dataset.py
    ```
    Результат будет в `data/food_dataset`.

### 2. Обучение детектора

Запустите обучение базовой модели детекции.
```bash
python src/training/train.py --epochs 150
````

Лучшая модель будет сохранена в папке `runs/detect/`.

### 3\. Анализ видео (с продвинутым трекингом)

Для запуска финальной версии системы с дообученным Re-ID трекером:

1.  **Создание Re-ID датасета:**
    ```bash
    # Укажите путь к лучшему детектору и папке с видео
    python src/data/create_reid_dataset.py --model path/to/best.pt --video_dir data/videos
    ```
2.  **Сортировка кропов:** Отсортируйте полученные изображения с помощью GUI-инструмента.
    ```bash
    python src/tools/reid_sorter.py
    ```
3.  **Дообучение Re-ID модели:**
    ```bash
    python src/training/finetune_reid.py
    ```
4.  **Финальный анализ:** Запустите анализ видео с использованием вашей лучшей модели детектора и дообученной Re-ID модели.
    ```bash
    # Укажите путь к лучшему детектору и видео для анализа
    python src/inference/analyze_lifecycle.py --model path/to/best.pt --video data/videos/4_1.MOV
    ```
    Результаты (видео и лог событий) будут сохранены в папке `reports/`.

## Конфигурация

  * **`data/dataset_configs/food_dataset.yaml`**: Конфигурация основного датасета для обучения детектора.
  * **`config/trackers/botsort.yaml`**: Настройки трекера. Здесь можно указать путь к дообученной Re-ID модели.

